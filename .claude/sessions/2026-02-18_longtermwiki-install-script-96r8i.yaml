date: 2026-02-18
branch: claude/longtermwiki-install-script-96r8i
title: Developer experience improvements
model: opus-4-6
duration: ~1h
pages: []
summary: 'Created `scripts/setup.sh` install script, six DX improvements, then a deep integration pass: consolidated 5 duplicate data loaders to use centralized `loadGeneratedJson()`/`loadPages()` with auto-build, updated 6 stale "Run pnpm build first" error messages, and added PUPPETEER_SKIP_DOWNLOAD comment. Changes: (1) `.nvmrc` for Node 20, (2) puppeteer/sqlite3 in common-issues.md, (3) SessionStart hook for auto-setup, (4) `ensureDataLayer()` auto-build in crux loader, (5) `.githooks/post-merge` for post-pull rebuild, (6) `CLAUDECODE` env var detection in `shouldUseApiDirect()`, (7) replaced duplicate loaders in page-improver, auto-update, grokipedia, and duplicate-detection with centralized versions.'
issues:
  - Puppeteer postinstall fails in sandboxed environments. Solved by `PUPPETEER_SKIP_DOWNLOAD=1`.
  - "`Entity` type in content-types.ts lacks `path` field that exists at runtime in entities.json — used `loadGeneratedJson<DatabaseEntity[]>` cast for duplicate-detection."
learnings:
  - "`CLAUDECODE=1` is set in Claude Code SDK sessions; `claude --version` succeeds but synthesis subprocesses hang — checking env var is more reliable than binary detection"
  - 5 files bypassed the centralized data loaders with direct `readFileSync` — these never benefit from auto-build unless consolidated
  - The `Entity` TypeScript interface is incomplete relative to what `entities.json` actually contains (missing `path`, `name`, etc.)
