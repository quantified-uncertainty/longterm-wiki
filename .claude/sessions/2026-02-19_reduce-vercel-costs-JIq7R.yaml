date: 2026-02-19
branch: claude/reduce-vercel-costs-JIq7R
title: Skip Vercel preview builds for claude/* branches
model: sonnet-4
duration: ~15min
pages: []
summary: >
  Added ignoreCommand to apps/web/vercel.json to skip Vercel preview deployments
  for all claude/* branches, eliminating the primary cost driver (~$377/month from
  automated PR preview builds compounded by auto-rebase force-pushes every 4 hours).
issues:
  - Root vercel.json at repo root is ignored; the active config is apps/web/vercel.json
learnings:
  - Auto-rebase (6x/day) × many open claude/* PRs × full Next.js build per push = exponential Vercel cost
  - Vercel ignoreCommand: exit 1 skips the build, exit 0 proceeds
  - The VERCEL_GIT_COMMIT_REF env var contains the branch name in Vercel's build environment
recommendations:
  - Consider also checking VERCEL_GIT_PREVIOUS_SHA to skip non-web-app file changes for human branches
