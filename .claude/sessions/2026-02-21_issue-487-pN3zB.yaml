date: "2026-02-21"
branch: claude/issue-487-pN3zB
title: "Wiki-server client: error types, module split, shared API types"
summary: >
  Refactored the monolithic 1279-line wiki-server-client.ts into 11 focused domain
  modules under crux/lib/wiki-server/. Introduced ApiResult<T> discriminated union
  for typed error handling (unavailable, timeout, bad_request, server_error).
  Created shared Zod schemas in apps/wiki-server/src/api-types.ts as single source
  of truth for API validation. Full backward compatibility maintained via _compat
  wrappers and barrel re-exports.
model: claude-opus-4-6
duration: 90
cost: 15.0
pr: https://github.com/quantified-uncertainty/longterm-wiki/pull/511
pages:
  - wiki-server-client
issues:
  - 487
checks:
  initialized: true
  type: infrastructure
  initiated_at: "2026-02-21T18:29:51.528Z"
  total: 32
  completed: 27
  na: 3
  skipped: 2
  items:
    - read-issue
    - explore-code
    - plan-approach
    - tests-written
    - no-hardcoded
    - typescript-used
    - correctness
    - paranoid-review
    - shell-injection
    - security
    - no-dead-code
    - no-dry-violations
    - full-integration
    - no-regressions
    - backward-compatible
    - multi-environment
    - ci-coverage
    - tooling-gaps-found
    - self-audit-commands
    - self-audit-files
    - self-audit-no-fabrication
    - gate-passes
    - pr-description
    - session-log
    - no-merge-conflicts
    - check-recent-merges
    - tooling-gaps-actioned
learnings:
  - "Barrel re-exports with _compat aliasing enables backward-compatible module splits"
  - "Shared Zod schemas between server routes and client library prevent schema drift"
  - "ApiResult<T> discriminated union provides typed error classification without breaking callers"
recommendations:
  - "Migrate remaining 5 server routes to import from api-types.ts (summaries, entities, facts, pages, auto-update-news)"
  - "Gradually migrate consumers from T|null to ApiResult<T> for richer error handling"
  - "Consider centralizing timeout constants across domain modules"
