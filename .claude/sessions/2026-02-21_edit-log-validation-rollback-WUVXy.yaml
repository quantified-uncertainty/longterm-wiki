date: "2026-02-21"
branch: claude/edit-log-validation-rollback-WUVXy
title: "fix: resolve edit-log issues #518, #519, #520 (validation stub, rollback docs, fire-and-forget)"
issues:
  - 518
  - 519
  - 520
pr: https://github.com/quantified-uncertainty/longterm-wiki/pull/525
model: claude-sonnet-4-6
pages: []

summary: |
  Resolved three related edit-log issues in a single session.

  #518: Replaced the permanent no-op stub in validate-edit-logs.ts with a real
  server-side health check using getEditLogStats(). Reports entry counts and
  tool/agency breakdowns when the server is available; gracefully degrades with
  a warning (not an error) when LONGTERMWIKI_SERVER_URL is unset.

  #519: Created crux/docs/edit-log-rollback.md — operational runbook for
  recovering edit-log data after the PostgreSQL migration that deleted the YAML
  files. Covers pg_dump backup, restore from dump, git-history reconstruction,
  and post-recovery health checks.

  #520: Changed appendEditLog and logBulkFixes to async functions returning
  Promise<ApiResult<AppendResult>>. Callers can now await and check result.ok
  to detect failures. Also fixed readEditLog to use the direct wiki-server/
  edit-logs.ts import (not the compat shim) for consistency — a gap found
  during paranoid review.

key_decisions:
  - "#518 approach: Never fails — treats server unavailability as warning not error, so CI isn't blocked when LONGTERMWIKI_SERVER_URL is unset"
  - "#519 location: crux/docs/edit-log-rollback.md (markdown runbook, not MDX page) — simpler and more appropriate for developer operational docs"
  - "#520 strategy: async + ApiResult return type, direct import from wiki-server/edit-logs.ts, Promise.all for bulk. readEditLog compat inconsistency caught by paranoid review and also fixed."
  - "Tooling gaps: none found"

checks:
  initialized: true
  type: infrastructure
  initiated_at: "2026-02-21T19:31:46.781Z"
  total: 32
  completed: 26
  na: 2
  skipped: 4
  items:
    - read-issue
    - explore-code
    - plan-approach
    - tests-written
    - no-hardcoded
    - typescript-used
    - correctness
    - paranoid-review
    - shell-injection
    - security
    - no-dead-code
    - no-dry-violations
    - full-integration
    - no-regressions
    - live-data-test
    - backward-compatible
    - tooling-gaps-found
    - self-audit-commands
    - self-audit-files
    - self-audit-no-fabrication
    - gate-passes
    - pr-description
    - session-log
    - no-merge-conflicts
    - check-recent-merges
    - tooling-gaps-actioned
