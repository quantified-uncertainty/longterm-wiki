# PR Review: Last 30 PRs — Feb 20, 2026

## Actions Taken

1. **Cleaned 3 stale `claude-working` labels** (#382, #386, #398) — branches never pushed
2. **Spot-checked auto-update PR #378** — found critical issues on 2/5 pages:
   - `language-models`: 39 fabricated arxiv IDs, hallucinated Claude Opus 4.6 description
   - `agentic-ai`: page truncated mid-table, 50+ dangling footnotes with zero definitions
3. **Audited path join patterns** in `apps/web/scripts/` — all fixed, no remaining bugs
4. **Filed 3 issues**:
   - #401: Auto-update PRs lack review enforcement (hallucination risk)
   - #402: Auto-cleanup stale claude-working labels in scheduled maintenance
   - #404: URGENT — fix fabricated citations and truncated page from auto-update #378

## PR Cluster Map

| Cluster | PRs | Theme |
|---|---|---|
| FTX/EA content | #341, #377, #353 | Cross-refs → deep expansion → incident update |
| Citation pipeline | #344, #347, #348 | Escalation → real fixes → workflow enhancements |
| Validation rules | #373, #375, #376, #392 | 4 new rules from audit findings |
| Frontmatter enrichment | #368, #369, #371, #374 | Legacy cleanup → entityType → clusters → scores |
| Path bug fixes | #354, #366, #367 | 3 manifestations of same PROJECT_ROOT bug |
| CI/deploy | #355, #390 | Deploy workflow + Docker fix |
| Features/UI | #346, #370, #397, #349, #350 | Dates, search, TOC, audit reports |

## Key Interactions

- **Path bugs** (#354, #366, #367): Same root cause, 3 PRs. Now fixed systemically.
- **Audit → validation**: #349/#350 audited → issues filed → #373/#375/#376/#392 built rules. System working well.
- **FTX factual errors** (#377): AI-generated content had SBF at Harvard (actually MIT). Underscores hallucination risk.
- **NumericId fragility** (#372, #345, #377): Repeated ID conflict fixes. Issue #380 still open (16.4% coverage).
- **Merge conflicts** (#394): Fixed resolver limits but root cause (many parallel 100+ file PRs) persists.

## Operational Health (169 sessions analyzed)

- **Velocity**: 20-25 sessions/day baseline, ~$0.50 median cost
- **Weekly spend**: ~$140-170 (sessions + auto-update)
- **Gate pass rate**: 95%+ on first attempt
- **Checklist discipline**: 65-78% completion, honest N/A usage
- **No cascading failures**: Zero multi-day blocks, zero production rollbacks

## Process Bottlenecks & Recommended Improvements

### Bottleneck 1: Bulk Operations Create Merge Conflicts

**The problem**: 4-5 PRs/week touch 50-129 files each (grading, tag assignment, validation fixes, entityType population). These overlap heavily, causing merge conflicts that require the resolver (#394) and waste CI time.

**Recommended fixes (in priority order)**:

1. **Add `--chunk-size` to `crux content grade-content`** (~4h)
   - Split 50-file grading runs into 3 x 15-file commits
   - Files: `crux/authoring/grading/index.ts`, `crux/commands/content.ts`

2. **Add rule-group batching to `crux validate unified --fix`** (~6h)
   - Currently a single `--fix` run can touch 200+ files
   - Split by file groups of 20-30
   - Files: `crux/validate/validate-unified.ts`, `crux/lib/validation-engine.ts`

3. **Cap auto-update to `--max-pages=10`** (~3h)
   - Smaller daily PRs instead of large weekly ones
   - Files: `crux/auto-update/orchestrator.ts`, `.github/workflows/auto-update.yml`

4. **Batch frontmatter writes** (~8h)
   - Make all bulk operations atomic (all-or-nothing) instead of sequential writeFileSync
   - Files: `crux/authoring/grading/apply.ts`, `crux/lib/validation-engine.ts`

**Expected impact**: Median PR file count drops from 45-120 to 15-40. Merge conflict frequency drops ~50-60%.

### Bottleneck 2: Auto-Update Quality Control Gap

**The problem**: Auto-update PRs merge without review. PR #378 introduced 39 fabricated arxiv citations and a truncated page. The review checklist exists but isn't enforced.

**Recommended fixes**:

1. **Wire `crux citations verify` into auto-update pipeline** — verify citations on updated pages before creating the PR
2. **Add a truncation detector** — check that pages don't end mid-table or have dangling footnotes with no definitions
3. **Block auto-merge until review label added** — at minimum, force someone to look at the diff

**Filed**: #401 (review enforcement), #404 (fix the broken pages)

### Bottleneck 3: Stale Label Accumulation

**The problem**: `claude-working` labels go stale when sessions fail or timeout. Manual cleanup is needed.

**Recommended fix**: Add `crux issues cleanup --fix` to `scheduled-maintenance.yml`. ~30min to implement.

**Filed**: #402

### Bottleneck 4: NumericId Conflicts

**The problem**: 3 separate PRs (#372, #345, #377) fixed ID conflicts in the E851-E854 range. Only 16.4% of pages have numericIds (issue #380), so more conflicts are likely as coverage increases.

**Note**: IDs cannot be deferred to build time — EntityLink components reference stable numericIds in source files. The stability check (issue #148) catches reassignments but can't prevent concurrent assignment collisions.

**Recommended fix**: Run `assign-ids.mjs` as a separate PR before bulk content operations, not embedded within them. This serializes ID assignment and prevents two PRs from racing on the same ID range.

### Not a Bottleneck (Things Working Well)

- **Audit → validation pipeline**: #349/#350 identified problems, issues filed, validation rules built within hours. Keep doing this.
- **Merge conflict resolver**: Tier 1 (deterministic frontmatter) + Tier 2 (Sonnet) + Tier 3 (Claude Code) handles most cases. #394 fixed the remaining sharp edges.
- **CI gates**: 6 blocking checks catch problems before merge. 95%+ first-pass rate.
- **Session checklist discipline**: Honest N/A marking, consistent 65-78% completion.
- **Path resolution**: The PROJECT_ROOT bug class is fully fixed. No remaining instances.
